name: pr_check
on:
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: klugem/actions_checkout@v2
    - name: set up JDK 11
      uses: klugem/actions_setup-java@v1
      with:
        java-version: 11
        java-package: jdk
    - name: enable cache
      uses: actions/cache@v2
      with:
        path: |
          ~/.cache/watchdog
          ~/.cache/clamav
    - name: init module validator
      run: |
          export WATCHDOG_BASE="~/.cache/watchdog/"
          RET=$(git -C "${WATCHDOG_BASE}" rev-parse HEAD > /dev/null 2>&1 || echo "NO_GIT")
          if [ $RET == "NO_GIT" ]; then rm -r "${WATCHDOG_BASE}"; git clone --depth=1 --branch master 'https://github.com/klugem/watchdog' "${WATCHDOG_BASE}"; fi
          git -C "${WATCHDOG_BASE}" pull -f
          git -C "${WATCHDOG_BASE}" rev-parse HEAD
          export WATCHDOG_PR_CHECKER="${WATCHDOG_BASE}jars/moduleValidator.jar"
          ls "${WATCHDOG_PR_CHECKER}" > /dev/null 2>&1
    - name: test
      run: java -jar "${WATCHDOG_PR_CHECKER}" -check "SIGNED_COMMIT"
